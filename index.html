<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Commande ESP32 - SÃ©curisÃ©e</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; margin-top: 40px; }
    .hidden { display: none; }
    input, button { padding: 10px; margin: 5px; font-size: 16px; }
  </style>
</head>
<body>
  <div id="loginForm">
    <h2>Connexion sÃ©curisÃ©e</h2>
    <input type="text" id="username" placeholder="Nom d'utilisateur"><br>
    <input type="password" id="password" placeholder="Mot de passe"><br>
    <button onclick="login()">Se connecter</button>
    <p id="errorMsg" style="color: red;"></p>
  </div>

  <div id="controlPanel" class="hidden">
    <h2>Station ESP32 - Commande</h2>
    <button onclick="sendCmd('pompe','ON')">ðŸš¿ Activer Pompe</button>
    <button onclick="sendCmd('pompe','OFF')">ðŸ›‘ DÃ©sactiver Pompe</button><br><br>
    <button onclick="sendCmd('buzzer','ON')">ðŸ”” Activer Buzzer</button>
    <button onclick="sendCmd('buzzer','OFF')">ðŸ”• DÃ©sactiver Buzzer</button><br><br>
    <button onclick="logout()">ðŸ”’ Se dÃ©connecter</button>
  </div>

  <script>
    const validUsername = "admin";
    const validPassword = "esp32pass";

    function login() {
      const user = document.getElementById("username").value;
      const pass = document.getElementById("password").value;
      if (user === validUsername && pass === validPassword) {
        document.getElementById("loginForm").classList.add("hidden");
        document.getElementById("controlPanel").classList.remove("hidden");
      } else {
        document.getElementById("errorMsg").innerText = "Identifiants incorrects !";
      }
    }

    function logout() {
      document.getElementById("controlPanel").classList.add("hidden");
      document.getElementById("loginForm").classList.remove("hidden");
    }

    async function sendCmd(component, value) {
      const response = await fetch('/api/commandes', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ [component]: value })
      });
      const result = await response.json();
      alert("âœ… Commande envoyÃ©e : " + JSON.stringify(result.state));
    }
  </script>
</body>
</html>
